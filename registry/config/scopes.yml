# Scopes Configuration for MCP Gateway Registry
#
# This file defines three main top-level groups:
# 1. UI-Scopes: Agent registry permissions (list, get, publish, modify, delete agents) and MCP service access
# 2. group_mappings: Maps Keycloak groups to scope names
# 3. Individual group scopes: Detailed MCP server method/tool access for each group
#
# Each group has two types of permissions:
# - Agent permissions: Actions on agent resources (list_agents, get_agent, publish_agent, modify_agent, delete_agent)
# - MCP server permissions: Methods and tools accessible on specific MCP servers (currenttime, mcpgw, fininfo, etc.)
#
# To add a new group, follow these three steps:
# 1. Add to UI-Scopes: Define agent and service permissions (what agents/services the group can access)
# 2. Add to group_mappings: Map the Keycloak group name to the internal scope name
# 3. Add individual group scope entry: Define detailed MCP server methods/tools and agent actions for the group

# ==================== UI-SCOPES ====================
# Define agent registry permissions and service listing rights for each group
UI-Scopes:
  # Admin user for MCP registry (highest privileges)
  mcp-registry-admin:
    list_agents:
    - all
    get_agent:
    - all
    publish_agent:
    - all
    modify_agent:
    - all
    delete_agent:
    - all
    list_service:
    - all
    register_service:
    - all
    health_check_service:
    - all
    toggle_service:
    - all
    modify_service:
    - all

  # Registry admin group (wildcard access to all agents and services)
  registry-admins:
    list_agents:
    - all
    get_agent:
    - all
    publish_agent:
    - all
    modify_agent:
    - all
    delete_agent:
    - all
    list_service:
    - all
    register_service:
    - all
    health_check_service:
    - all
    toggle_service:
    - all
    modify_service:
    - all

  # LOB1 (Line of Business 1): Restricted to code-reviewer and test-automation agents
  registry-users-lob1:
    list_agents:
    - /code-reviewer
    - /test-automation
    get_agent:
    - /code-reviewer
    - /test-automation
    publish_agent:
    - /code-reviewer
    - /test-automation
    modify_agent:
    - /code-reviewer
    - /test-automation
    delete_agent:
    - /code-reviewer
    - /test-automation
    list_service:
    - currenttime
    - mcpgw
    health_check_service:
    - currenttime
    - mcpgw

  # LOB2 (Line of Business 2): Restricted to data-analysis and security-analyzer agents
  registry-users-lob2:
    list_agents:
    - /data-analysis
    - /security-analyzer
    get_agent:
    - /data-analysis
    - /security-analyzer
    publish_agent:
    - /data-analysis
    - /security-analyzer
    modify_agent:
    - /data-analysis
    - /security-analyzer
    delete_agent:
    - /data-analysis
    - /security-analyzer
    list_service:
    - realserverfaketools
    - mcpgw
    - fininfo
    health_check_service:
    - realserverfaketools
    - mcpgw
    - fininfo

# ==================== GROUP MAPPINGS ====================
# Maps Keycloak groups to internal scope group names
group_mappings:
  mcp-registry-admin:
  - mcp-registry-admin
  - mcp-servers-unrestricted/read
  - mcp-servers-unrestricted/execute
  registry-admins:
  - registry-admins
  registry-users-lob1:
  - registry-users-lob1
  registry-users-lob2:
  - registry-users-lob2

# ==================== MCP SERVER SCOPES ====================
# Unrestricted read access: Wildcard access to all servers with all methods and tools
mcp-servers-unrestricted/read:
- server: '*'
  methods:
  - initialize
  - notifications/initialized
  - ping
  - tools/list
  - tools/call
  - resources/list
  - resources/templates/list
  - GET
  tools: '*'
- server: api
  methods:
  - tokens
  - GET

# Unrestricted execute access: Full CRUD operations on all servers (POST, PUT, DELETE in addition to read)
mcp-servers-unrestricted/execute:
- server: '*'
  methods:
  - initialize
  - notifications/initialized
  - ping
  - tools/list
  - tools/call
  - resources/list
  - resources/templates/list
  - GET
  - POST
  - PUT
  - DELETE
  tools: '*'
- server: api
  methods:
  - tokens
  - GET
  - POST

# LOB1 Group Scope: Read-only access to API; currenttime and mcpgw servers; code-reviewer and test-automation agents
registry-users-lob1:
- server: api
  methods:
  - initialize
  - GET
- server: currenttime
  methods:
  - initialize
  - notifications/initialized
  - ping
  - tools/list
  - tools/call
  - resources/list
  - resources/templates/list
  tools:
  - current_time_by_timezone
- server: mcpgw
  methods:
  - initialize
  - notifications/initialized
  - ping
  - tools/list
  - tools/call
  - resources/list
  - resources/templates/list
  tools:
  - intelligent_tool_finder
- agents:
    actions:
    - action: list_agents
      resources:
      - /code-reviewer
      - /test-automation
    - action: get_agent
      resources:
      - /code-reviewer
      - /test-automation
    - action: publish_agent
      resources:
      - /code-reviewer
      - /test-automation
    - action: modify_agent
      resources:
      - /code-reviewer
      - /test-automation
    - action: delete_agent
      resources:
      - /code-reviewer
      - /test-automation

# LOB2 Group Scope: Read-only access to API; realserverfaketools, mcpgw, fininfo servers; data-analysis and security-analyzer agents
registry-users-lob2:
- server: api
  methods:
  - initialize
  - GET
- server: realserverfaketools
  methods:
  - initialize
  - notifications/initialized
  - ping
  - tools/list
  - tools/call
  - resources/list
  - resources/templates/list
  tools:
  - quantum_flux_analyzer
  - neural_pattern_synthesizer
  - hyper_dimensional_mapper
- server: mcpgw
  methods:
  - initialize
  - notifications/initialized
  - ping
  - tools/list
  - tools/call
  - resources/list
  - resources/templates/list
  tools:
  - intelligent_tool_finder
- server: fininfo
  methods:
  - initialize
  - notifications/initialized
  - ping
  - tools/list
  - tools/call
  - resources/list
  - resources/templates/list
  tools:
  - get_stock_aggregates
  - print_stock_data
- agents:
    actions:
    - action: list_agents
      resources:
      - /data-analysis
      - /security-analyzer
    - action: get_agent
      resources:
      - /data-analysis
      - /security-analyzer
    - action: publish_agent
      resources:
      - /data-analysis
      - /security-analyzer
    - action: modify_agent
      resources:
      - /data-analysis
      - /security-analyzer
    - action: delete_agent
      resources:
      - /data-analysis
      - /security-analyzer

# Admin Group Scope: Unrestricted access to all servers with wildcard; unrestricted access to all agents
registry-admins:
- server: '*'
  methods:
  - all
  tools:
  - all
- agents:
    actions:
    - action: list_agents
      resources:
      - all
    - action: get_agent
      resources:
      - all
    - action: publish_agent
      resources:
      - all
    - action: modify_agent
      resources:
      - all
    - action: delete_agent
      resources:
      - all